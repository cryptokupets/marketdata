<mvc:View controllerName="ck.marketdata.controller.Candles" 
  xmlns:mvc="sap.ui.core.mvc" 
  xmlns:core="sap.ui.core" 
  xmlns:l="sap.ui.layout" 
  xmlns:form="sap.ui.layout.form" 
  xmlns="sap.m" 
  xmlns:chart="openui5.financial.chart" 
  xmlns:indicator="openui5.financial.chart.indicator" 
  displayBlock="true">
  <Page enableScrolling="false" 
    showNavButton="true" 
    navButtonPress="onBackPress" 
    showHeader="true">
    <headerContent>
      <Button icon="sap-icon://refresh" 
        text="Refresh" 
        press="onRefreshPress"/>
    </headerContent>
    <content>
      <l:ResponsiveSplitter>
        <l:PaneContainer>
          <l:PaneContainer orientation="Vertical">
            <l:SplitPane>
              <form:Form editable="true">
                <form:layout>
                  <form:ResponsiveGridLayout labelSpanXL="2" 
                    labelSpanL="2" 
                    labelSpanM="3" 
                    labelSpanS="6" 
                    adjustLabelSpan="false" 
                    emptySpanXL="0" 
                    emptySpanL="0" 
                    emptySpanM="0" 
                    emptySpanS="0" 
                    columnsXL="12" 
                    columnsL="6" 
                    columnsM="4"/>
                </form:layout>
                <form:formContainers>
                  <form:FormContainer>
                    <form:formElements>
                      <form:FormElement label="Exchange">
                        <Text text="{key}">
                          <layoutData>
                            <l:GridData span="XL2 L2 M3 S6"/>
                          </layoutData>
                        </Text>
                      </form:FormElement>
                      <form:FormElement label="Currency">
                        <ComboBox selectedKey="{buffer>/currencyKey}" 
                          items="{Currencies}" 
                          change="onCurrencyChange">
                          <layoutData>
                            <l:GridData span="XL2 L2 M3 S6"/>
                          </layoutData>
                          <items>
                            <core:Item text="{key}" 
                              key="{key}"/>
                          </items>
                        </ComboBox>
                      </form:FormElement>
                      <form:FormElement label="Asset">
                        <ComboBox id="asset" 
                          selectedKey="{buffer>/assetKey}" 
                          change="onAssetChange">
                          <layoutData>
                            <l:GridData span="XL2 L2 M3 S6"/>
                          </layoutData>
                        </ComboBox>
                      </form:FormElement>
                      <form:FormElement label="Timeframe">
                        <ComboBox selectedKey="{buffer>/timeframe}" 
                          items="{Timeframes}" 
                          change="onTimeframeChange">
                          <layoutData>
                            <l:GridData span="XL2 L2 M3 S6"/>
                          </layoutData>
                          <items>
                            <core:Item text="{key}" 
                              key="{key}"/>
                          </items>
                        </ComboBox>
                      </form:FormElement>
                      <form:FormElement label="Start">
                        <DatePicker id="start" 
                          displayFormat="short" 
                          valueFormat="yyyy-MM-dd" 
                          value="{buffer>/start}">
                          <layoutData>
                            <l:GridData span="XL2 L2 M3 S6"/>
                          </layoutData>
                        </DatePicker>
                      </form:FormElement>
                      <form:FormElement label="End">
                        <DatePicker id="end" 
                          displayFormat="short" 
                          valueFormat="yyyy-MM-dd" 
                          value="{buffer>/end}">
                          <layoutData>
                            <l:GridData span="XL2 L2 M3 S6"/>
                          </layoutData>
                        </DatePicker>
                      </form:FormElement>
                      <form:FormElement label="Indicators">
                        <Input value="{buffer>/indicatorInputs}">
                          <layoutData>
                            <l:GridData span="XL2 L2 M3 S6"/>
                          </layoutData>
                        </Input>
                      </form:FormElement>
                    </form:formElements>
                  </form:FormContainer>
                </form:formContainers>
              </form:Form>
            </l:SplitPane>
            <l:SplitPane>
              <VBox height="100%">
                <chart:Chart id="candlestick" 
                  height="300px" 
                  padding="5 20 25 60" 
                  start="{buffer>/start}" 
                  end="{buffer>/end}" 
                  timeframe="60">
                  <chart:CandlestickChart items="{charts>/candles}">
                    <chart:Candle time="{charts>time}" 
                      open="{charts>open}" 
                      high="{charts>high}" 
                      low="{charts>low}" 
                      close="{charts>close}"/>
                  </chart:CandlestickChart>
                </chart:Chart>
                <!-- <chart:Chart id="indicator0" height="90px" padding="5 20 25 60" start="{buffer>/start}" end="{buffer>/end}" timeframe="60">
                  <indicator:CCIOZ items="{charts>/indicators/0/output}" overboughtZone="100" oversoldZone="-100">
                    <chart:LineChartItem time="{charts>time}" value="{charts>values/0}"/>
                  </indicator:CCIOZ>
                </chart:Chart> -->
                <!-- <chart:Chart id="indicator1" height="90px" padding="5 20 25 60" start="{buffer>/start}" end="{buffer>/end}" timeframe="60">
                  <indicator:MACD items="{charts>/indicators/1/output}">
                    <indicator:MACDItem time="{charts>time}" macd="{charts>values/0}" trigger="{charts>values/1}" histogram="{charts>values/2}"/>
                  </indicator:MACD>
                </chart:Chart> -->
                <VBox id="indicators" 
                  items="{
                    model: 'charts1',
                    path: '/indicators',
                    factory: '.factory',
                    templateShareable: false
                  }">
                  <dependents>
                    <core:Fragment fragmentName="ck.marketdata.fragment.CCIOZ" 
                      type="XML"/>
                    <core:Fragment fragmentName="ck.marketdata.fragment.MACD" 
                      type="XML"/>
                  </dependents>
                </VBox>
              </VBox>
            </l:SplitPane>
          </l:PaneContainer>
        </l:PaneContainer>
      </l:ResponsiveSplitter>
    </content>
  </Page>
</mvc:View>
